# Описание решений проектной работы

## Задание 1. Планирование архитектуры MongoDB

#### Схема 1: Шардирование (`step1_sharding.drawio`)

**Архитектурные компоненты**:
- **1x pymongo-api**: FastAPI приложение
- **3x mongos роутеры**: `mongos-r1`, `mongos-r2`, `mongos-r3` для балансировки запросов
- **3x Config Servers**: `configSrv-1`, `configSrv-2`, `configSrv-3` для хранения метаданных кластера
- **2x Шарды**: `shard1`, `shard2` для распределения данных

#### Схема 2: Репликация (`step2_replication.drawio`)
**Решаемая проблема**: Обеспечение высокой доступности (High Availability)

**Архитектурные изменения**:
- Каждый шард преобразован в Replica Set с 3 узлами
- Config Servers объединены в Replica Set

#### Схема 3: Кеширование (`step3_caching.drawio`)
**Решаемая проблема**: Максимизация производительности через кеширование горячих данных

**Новые компоненты**:
- **Redis/Valkey Cluster**: расположен справа от приложения для четкого отображения Cache-Aside паттерна
- **Оранжевая толстая стрелка**: приоритетный путь кеширования между app и Redis

### Техническая реализация

**Компоненты схемы 1 (Шардирование)**:
- Приложение подключается ко всем mongos для балансировки
- Роутеры консультируются с Config Servers для получения метаданных
- Данные равномерно распределяются между шардами по hash(user_id)

**Компоненты схемы 2 (Репликация)**:
- Каждый Replica Set содержит 1 Primary + 2 Secondary узла
- Внутренняя репликация обозначена пунктирными цветными линиями
- Запросы идут к Primary узлам, репликация автоматическая

**Компоненты схемы 3 (Кеширование)**:
- Cache-Aside паттерн с приоритетным обращением к Redis/Valkey
- При Cache Miss запрос проходит через всю MongoDB архитектуру
- Результаты кешируются с TTL для последующих запросов

### Результат
Создана полная эволюционная архитектура, готовая к нагрузкам Black Friday:
- **Горизонтальное масштабирование** через шардирование
- **Высокая доступность** через репликацию  
- **Низкая латентность** через кеширование
- **Визуальная ясность** финальных схем для команды разработки
- **Минималистичный дизайн** без информационной перегрузки

---
